
USE dbplivn
GO

    [NIDBOL] INT              
    [CODEMP] INT              NOT NULL,
    [KEYBOL] UNIQUEIDENTIFIER NOT NULL,
    [SUBSYS] TINYINT          NOT NULL,
    [NIDCBL] INT              NOT NULL,
    [USUPRO] INT              NOT NULL,
    [USUCED] INT              NOT NULL,
    [USUSAC] INT              NOT NULL,
    [CODAVA] INT              NOT NULL,
    [CODEND] INT              NOT NULL,
    [CODMOE] INT              NOT NULL,
    [STABOL] SMALLINT         NOT NULL,
    [CODVER] SMALLINT         NOT NULL,
    [TIPBOL] TINYINT          NOT NULL,
    [DATEMI] DATETIME         NOT NULL,
    [DATVCT] DATE             NOT NULL,
    [DATPGT] DATE             NULL,
    [DATVAL] DATE             NOT NULL,
    [DATREG] DATETIME         NOT NULL,
    [NUMPCL] SMALLINT         NOT NULL,
    [CODCED] VARCHAR (25)     NULL,
    [NIDLIM] INT              NOT NULL,
    [NUMIPA] VARCHAR (50)     NOT NULL,
    [ORGBOL] INT              NOT NULL,
    [INSBC1] VARCHAR (30)     NOT NULL,
    [INSBC2] VARCHAR (30)     NOT NULL,
    [INSBC3] VARCHAR (30)     NOT NULL,
    [DSCBOL] VARCHAR (255)    NULL,
    [URLRET] VARCHAR (255)    NULL,
    [CODRET] INT              NOT NULL,
    [FILNAM] VARCHAR (100)    NULL,
    [NIDCTA] INT              NOT NULL,
    [NUMDVF] SMALLINT         NOT NULL,
    [PEDCLI] VARCHAR (15)     NULL,
    [LINDIG] VARCHAR (64)     NULL,
    [CODESP] VARCHAR (3)      NOT NULL,
    [NUMCTR] VARCHAR (3)      NOT NULL,
    [NOSNUM] INT              NOT NULL,
    [IMGSAV] BIT              NOT NULL,
    [INDCNC] BIT              NOT NULL,
    [APLCAL] TINYINT          NOT NULL,
    [REGPRO] INT              NOT NULL,
    [RSPTAR] TINYINT          NOT NULL,
    [VLRBOL] MONEY            NOT NULL,
    [VLRTAR] MONEY            NOT NULL,
    [VLRTDP] MONEY            NOT NULL,
    [STAREC] INT              NOT NULL,
    [DATCAD] DATETIME         NOT NULL,
    [DATUPD] DATETIME         NOT NULL,
    [UPDUSU] INT              NOT NULL


SELECT NIDREF, VLRTOT = SUM(VLROPE*SIGOPE) FROM TBREGOPE WHERE STAREC=1 GROUP BY NIDREF

SELECT * FROM TBTABGER WHERE NUMTAB=16

SELECT A.* 
      ,CEDNOM = B.NOMUSU
	  ,CEDCMF = dbo.FormatCMF(B.CODCMF)
      ,SACNOM = C.NOMUSU
	  ,SACCMF = dbo.FormatCMF(C.CODCMF)
	  ,SACMAL = F.DSCEND
      ,AVANOM = D.NOMUSU
	  ,AVACMF = dbo.FormatCMF(D.CODCMF)
	  ,DSCLOG = ISNULL(G.DSCTAB,'')
	  ,DSCEND = ISNULL(E.DSCEND,'')
	  ,DSCCPL = ISNULL(E.DSCCPL,'')
	  ,NUMEND = ISNULL(E.NUMEND,'')
	  ,DSCCID = ISNULL(E.DSCCID,'')
	  ,DSCBAI = ISNULL(E.DSCBAI,'')
	  ,CODCEP=  dbo.FormatCep(E.CODCEP)
	  ,VLRLIQ = ISNULL(H.VLRLIQ,0)
  FROM TBREGBOL (NOLOCK) A
 INNER JOIN TBCADGER (NOLOCK) B ON (B.CODUSU = A.USUCED)
 INNER JOIN TBCADGER (NOLOCK) C ON (C.CODUSU = A.USUSAC)
  LEFT JOIN TBCADGER (NOLOCK) D ON (D.CODUSU = A.CODAVA)
  LEFT JOIN TBCADEND (NOLOCK) E ON (E.CODEND = A.CODEND)
 INNER JOIN TBTABGER (NOLOCK) G ON (G.NUMTAB=81 AND G.KEYCOD = E.TIPLOG)
 INNER JOIN (SELECT DSCEND, CODUSU FROM TBCADEND (NOLOCK) WHERE TIPEND = 3 AND STAREC=1 AND REGATV=1)  F ON (F.CODUSU = A.USUSAC)
 INNER JOIN (SELECT NIDREF, VLRLIQ = SUM(VLROPE*SIGOPE) FROM TBREGOPE (NOLOCK) WHERE SUBSYS =2 AND STAREC=1 GROUP BY NIDREF) H ON (H.NIDREF= A.NIDBOL)


SELECT A.* 
      ,CEDNOM = B.NOMUSU
	  ,CEDCMF = dbo.FormatCMF(B.CODCMF)
      ,SACNOM = C.NOMUSU
	  ,SACCMF = dbo.FormatCMF(C.CODCMF)
	  ,SACMAL = F.DSCEND
      ,AVANOM = D.NOMUSU
	  ,AVACMF = dbo.FormatCMF(D.CODCMF)
	  ,DSCBOL = G.DSCTAB
	  ,H.DSCSTA
  FROM TBREGBOL (NOLOCK) A
 INNER JOIN TBCADGER (NOLOCK) B ON (B.CODUSU = A.USUCED)
 INNER JOIN TBCADGER (NOLOCK) C ON (C.CODUSU = A.USUSAC)
 INNER JOIN TBCADGER (NOLOCK) D ON (D.CODUSU = A.CODAVA)
  LEFT JOIN TBCADEND (NOLOCK) E ON (E.CODEND = A.CODEND)
 INNER JOIN (SELECT DSCEND, CODUSU FROM TBCADEND (NOLOCK) WHERE TIPEND = 3 AND STAREC=1 AND REGATV=1)  F ON (F.CODUSU = A.USUSAC)
 INNER JOIN TBTABGER (NOLOCK) G ON (G.NUMTAB=16 AND G.KEYCOD = A.TIPBOL)
 INNER JOIN TBCADSTA (NOLOCK) H ON (H.CODSTA = A.STABOL)
 INNER JOIN (SELECT NIDREF, VLRLIQ = ISNULL(SUM(VLROPE*SIGOPE),0) FROM TBREGOPE (NOLOCK) WHERE SUBSYS =2 AND STAREC=1 GROUP BY NIDREF) I ON (I.NIDREF= A.NIDBOL)
 